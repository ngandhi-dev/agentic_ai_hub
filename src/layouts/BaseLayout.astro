---
import NewsletterModal from "../components/NewsletterModal.astro";
import "../styles/global.css";
const { title } = Astro.props;

---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <header class="border-b bg-white">
      <nav class="max-w-5xl mx-auto p-4 flex justify-between">
        <a href="/" class="font-bold text-lg">My News</a>        
      </nav>
    </header>

    <main class="max-w-5xl mx-auto p-4">
      <slot />
    </main>

    <footer class="border-t mt-10 p-4 text-sm text-center text-gray-500">
      Â© {new Date().getFullYear()} My News
    </footer>
  </body>
</html>

<script>
  import { supabase } from '../lib/supabase';
  
  async function trackVisit() {
    // Get the current path (e.g., /pulse/issue-1)
    const path = window.location.pathname;
    console.log("Attempting to track visit for:", path);

    // Prevent tracking during local development if desired
    //if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
      console.log("Local visit detected - skipping DB update");
      const { data, error } = await supabase.rpc('increment_visit', { 
      page_url: path});
    //  return;
    if (error) {
      console.error('Supabase RPC Error:', error.message);
      console.error('Error Details:', error);
    } else {
      console.log('Visit tracked successfully for:', path);
    }
    }
    // Run on page load
  trackVisit();
    
    if (error) console.error('Analytics Error:', error.message);
  }
  
  
</script>

